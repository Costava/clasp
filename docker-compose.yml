version: '2'
services:
  clasp-min-run:
    image: clasp-min-run
    build:
      context: .
      dockerfile: tools/dockerfiles/clasp-min-run/Dockerfile
    depends_on:
      - clasp-min-install
  clasp-min-install:
    image: clasp-min-install
    build:
      context: .
      dockerfile: tools/dockerfiles/clasp-min-install/Dockerfile
    depends_on:
      - clasp-copy-out
      - clasp-min-dependencies
  clasp-copy-out:
    image: clasp-copy-out
    build:
      context: .
      dockerfile: tools/dockerfiles/clasp-copy-out/Dockerfile
    volumes:
      - ./container:/tmp/clasp
    command: cp -av install/ /tmp/clasp/
    depends_on:
      - clasp-full-build
  clasp-full-build:
    image: clasp-full-build
    build:
      context: .
      dockerfile: tools/dockerfiles/clasp-full-build/Dockerfile
      args:
        CANDO_REVISION: dev
    volumes:
      - /tmp/install:/home/app/clasp/install
    depends_on:
      - clasp-dependencies
  clasp-min-dependencies:
    image: clasp-min-dependencies
    build:
      context: tools/dockerfiles/clasp-min-dependencies
    command: echo Done building clasp-min-dependencies.
  clasp-dependencies:
    image: clasp-dependencies
    build:
      context: tools/dockerfiles/clasp-dependencies
      args:
        EXTERNALS_REVISION: master
    command: echo Done building clasp-dependencies.
